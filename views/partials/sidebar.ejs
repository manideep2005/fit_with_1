<style>
.sidebar { background: #ffffff !important; border: 1px solid #e2e8f0 !important; border-radius: 12px !important; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important; padding: 30px 20px !important; position: sticky !important; top: 20px !important; height: fit-content !important; }
.sidebar-header { display: flex !important; align-items: center !important; margin-bottom: 2rem !important; padding: 0 1rem !important; }
.user-avatar { width: 40px !important; height: 40px !important; border-radius: 50% !important; margin-right: 10px !important; background: #6366f1 !important; color: white !important; display: flex !important; align-items: center !important; justify-content: center !important; font-weight: 600 !important; font-size: 1.2rem !important; flex-shrink: 0 !important; }
.user-name { font-weight: 600 !important; margin: 0 !important; color: #1e293b !important; font-size: 0.9rem !important; }
.user-plan { font-size: 0.8rem !important; color: #6366f1 !important; background: rgba(99, 102, 241, 0.1) !important; padding: 2px 8px !important; border-radius: 20px !important; margin-top: 5px !important; display: block !important; }
.nav-menu { list-style: none !important; padding: 0 !important; margin: 0 !important; }
.nav-item { margin-bottom: 5px !important; }
.nav-link { display: flex !important; align-items: center !important; padding: 12px 15px !important; color: #64748b !important; text-decoration: none !important; border-radius: 8px !important; transition: all 0.3s ease !important; font-size: 0.9rem !important; font-weight: 500 !important; }
.nav-link:hover { background: rgba(99, 102, 241, 0.1) !important; color: #6366f1 !important; }
.nav-link.active { background: #6366f1 !important; color: white !important; }
.nav-link i { margin-right: 10px !important; font-size: 1rem !important; width: 16px !important; text-align: center !important; }
.logout-section { margin-top: 2rem !important; padding-top: 1rem !important; border-top: 1px solid #e2e8f0 !important; }
.logout-link { display: flex !important; align-items: center !important; padding: 12px 1rem !important; color: #ef4444 !important; text-decoration: none !important; border-radius: 8px !important; transition: all 0.3s ease !important; font-weight: 500 !important; font-size: 0.9rem !important; }
.logout-link:hover { background: rgba(239, 68, 68, 0.1) !important; color: #ef4444 !important; }
.logout-link i { margin-right: 10px !important; font-size: 1rem !important; }
</style>
<div class="sidebar">
    <div class="sidebar-header">
        <div class="user-avatar"><%= user.fullName.charAt(0).toUpperCase() %></div>
        <div>
            <h3 class="user-name"><%= user.fullName %></h3>
            <span class="user-plan" id="sidebar-plan">
                <% 
                const planNames = {
                    'free': 'Free Plan',
                    'basic': 'Basic Pro',
                    'premium': 'Premium Pro',
                    'yearly': 'Yearly Premium'
                };
                const currentPlan = user.subscription?.plan || 'free';
                const planName = planNames[currentPlan] || 'Free Plan';
                const isPremium = currentPlan !== 'free';
                %>
                <% if (isPremium) { %>
                    <i class="fas fa-crown" style="color: #ffd700; margin-right: 5px;"></i>
                <% } %>
                <%= planName %>
            </span>
        </div>
    </div>
    
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="/dashboard?nav=<%= navId %>" class="nav-link <%= currentPage === 'dashboard' ? 'active' : '' %>">
                <i class="fas fa-home"></i> Dashboard
            </a>
        </li>
        <li class="nav-item">
            <a href="/workouts?nav=<%= navId %>" class="nav-link <%= currentPage === 'workouts' ? 'active' : '' %>">
                <i class="fas fa-dumbbell"></i> Workouts
            </a>
        </li>
        <li class="nav-item">
            <a href="/progress?nav=<%= navId %>" class="nav-link <%= currentPage === 'progress' ? 'active' : '' %>">
                <i class="fas fa-chart-line"></i> Progress
            </a>
        </li>
        <li class="nav-item">
            <a href="/nutrition?nav=<%= navId %>" class="nav-link <%= currentPage === 'nutrition' ? 'active' : '' %>">
                <i class="fas fa-utensils"></i> Nutrition
            </a>
        </li>
        <li class="nav-item">
            <a href="/nutriscan?nav=<%= navId %>" class="nav-link <%= currentPage === 'nutriscan' ? 'active' : '' %>">
                <i class="fas fa-qrcode"></i> NutriScan
            </a>
        </li>
        <li class="nav-item">
            <a href="/meal-planner?nav=<%= navId %>" class="nav-link <%= currentPage === 'meal-planner' ? 'active' : '' %>">
                <i class="fas fa-calendar-check"></i> Meal Planner
            </a>
        </li>
        <li class="nav-item">
            <a href="/challenges?nav=<%= navId %>" class="nav-link <%= currentPage === 'challenges' ? 'active' : '' %>">
                <i class="fas fa-trophy"></i> Challenges
            </a>
        </li>
        <li class="nav-item">
            <a href="/schedule?nav=<%= navId %>" class="nav-link <%= currentPage === 'schedule' ? 'active' : '' %>">
                <i class="fas fa-calendar-alt"></i> Schedule
            </a>
        </li>
        <li class="nav-item">
            <a href="/community?nav=<%= navId %>" class="nav-link <%= currentPage === 'community' ? 'active' : '' %>">
                <i class="fas fa-users"></i> Community
            </a>
        </li>
        <li class="nav-item">
            <a href="/chat?nav=<%= navId %>" class="nav-link <%= currentPage === 'chat' ? 'active' : '' %>">
                <i class="fas fa-comments"></i> Chat
            </a>
        </li>
        <li class="nav-item">
            <a href="/ai-coach?nav=<%= navId %>" class="nav-link <%= currentPage === 'ai-coach' ? 'active' : '' %>">
                <i class="fas fa-robot"></i> AI Coach
            </a>
        </li>
        <li class="nav-item">
            <a href="/gamification?nav=<%= navId %>" class="nav-link <%= currentPage === 'gamification' ? 'active' : '' %>">
                <i class="fas fa-trophy"></i> Rewards & Streaks
            </a>
        </li>
        <li class="nav-item">
            <a href="/virtual-doctor?nav=<%= navId %>" class="nav-link <%= currentPage === 'virtual-doctor' ? 'active' : '' %>">
                <i class="fas fa-user-md"></i> Virtual Doctor
            </a>
        </li>
        <li class="nav-item">
            <a href="/subscription?nav=<%= navId %>" class="nav-link <%= currentPage === 'subscription' ? 'active' : '' %>">
                <i class="fas fa-crown"></i> Subscription
            </a>
        </li>
        <li class="nav-item">
            <a href="/settings?nav=<%= navId %>" class="nav-link <%= currentPage === 'settings' ? 'active' : '' %>">
                <i class="fas fa-cog"></i> Settings
            </a>
        </li>
    </ul>
    
    <script>
        // Update plan status dynamically
        document.addEventListener('DOMContentLoaded', function() {
            const paymentSuccess = localStorage.getItem('paymentSuccess');
            if (paymentSuccess) {
                const payment = JSON.parse(paymentSuccess);
                const sidebarPlan = document.getElementById('sidebar-plan');
                if (sidebarPlan) {
                    sidebarPlan.innerHTML = `<i class="fas fa-crown" style="color: #ffd700; margin-right: 5px;"></i>${payment.plan}`;
                }
            }
        });
        

    </script>
    
    <div class="logout-section">
        <a href="/logout" class="logout-link">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
    
    <!-- Include global logout toast handler -->
    <script src="/js/logout-toast.js"></script>
</div>
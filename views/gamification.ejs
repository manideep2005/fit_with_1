<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamification Dashboard - Fit-With-AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
         :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray: #64748b;
            --light-gray: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #ffffff;
            color: #1e293b;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .dashboard-container {
            min-height: 100vh;
            padding: 20px;
        }
        

        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .welcome-card {
            background: #ffffff;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            color: var(--dark);
            padding: 30px;
            margin-bottom: 25px;
        }
        
        .welcome-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .welcome-subtitle {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: #ffffff;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0 8px 0;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .workout-plan {
            background: transparent;
            border: none;
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.5s ease;
            overflow: hidden;
            position: relative;
        }
        
        .workout-plan::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(108, 99, 255, 0.1) 0%,
                rgba(255, 255, 255, 0.03) 50%,
                rgba(108, 99, 255, 0.08) 100%);
            z-index: -1;
        }
        
        .workout-plan:hover {
            clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 15px 100%, 0 calc(100% - 15px));
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(108, 99, 255, 0.3);
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .workout-title {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .workout-day {
            display: flex;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .workout-day:last-child {
            margin-bottom: 0;
        }
        
        .day-name {
            font-weight: 600;
            min-width: 100px;
        }
        
        .day-workout {
            flex: 1;
        }
        
        .day-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .day-status.completed {
            background: var(--success);
        }
        
        .nutrition-tip {
            background: transparent;
            border: none;
            padding: 30px;
            transition: all 0.3s ease;
        }
        
        .nutrition-tip:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(108, 99, 255, 0.2);
        }
        
        .tip-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .tip-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(108, 99, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary);
        }
        
        .tip-title {
            font-weight: 600;
        }
        
        .tip-content {
            color: var(--gray);
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
        }
        
        .btn-outline {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        /* New styles for rewards and streaks */
        .level-display {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px -3px rgba(99, 102, 241, 0.3);
        }
        
        .level-number {
            font-size: 4rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .xp-progress {
            background: rgba(255, 255, 255, 0.2);
            height: 12px;
            border-radius: 6px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .xp-progress-bar {
            background: rgba(255, 255, 255, 0.9);
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .nav-pills .nav-link {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border-radius: 25px;
            margin: 0 5px;
            padding: 12px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link.active {
            background: var(--primary);
            color: white;
        }
        
        .streak-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .streak-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }
        
        .streak-number {
            font-size: 3rem;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .streak-workout { color: #f59e0b; }
        .streak-nutrition { color: #10b981; }
        .streak-login { color: #6366f1; }
        
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .achievement-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .achievement-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }
        
        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .reward-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .reward-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -3px rgba(0, 0, 0, 0.1);
        }
        
        .reward-health {
            border-left: 4px solid #10b981;
        }
        
        .reward-fitness {
            border-left: 4px solid #f59e0b;
        }
        
        .reward-used {
            opacity: 0.6;
            background: #f8fafc;
        }
        
        .reward-expired {
            opacity: 0.7;
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        
        .milestone-card {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .milestone-next {
            border: 2px solid var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
        }
        
        .character-stats {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .stat-bar {
            background: var(--light-gray);
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .stat-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .stat-strength { background: #ef4444; }
        .stat-endurance { background: #f59e0b; }
        .stat-flexibility { background: #10b981; }
        .stat-nutrition { background: #8b5cf6; }
        .stat-consistency { background: #6366f1; }
        
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 1rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>


    <div class="dashboard-container">
        <div class="container-fluid">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="text-center mb-0 page-title">
                        <i class="fas fa-trophy me-3 text-warning"></i>Rewards & Streaks
                    </h1>
                    <p class="text-muted text-center">Track your progress, earn rewards, and level up!</p>
                </div>
            </div>

            <!-- Level Display -->
            <div class="row">
                <div class="col-md-4 mx-auto">
                    <div class="level-display">
                        <h3>Level</h3>
                        <p class="level-number" id="userLevel">1</p>
                        <div class="xp-progress">
                            <div class="xp-progress-bar" id="xpProgressBar" style="width: 0%"></div>
                        </div>
                        <p id="xpText">0 / 100 XP</p>
                        <small id="xpToNext">100 XP to next level</small>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="row">
                <div class="col-12">
                    <ul class="nav nav-pills justify-content-center" id="gamificationTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="pill" href="#streaks">
                                <i class="fas fa-fire me-2"></i>Streaks
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="pill" href="#achievements">
                                <i class="fas fa-medal me-2"></i>Achievements
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="pill" href="#rewards">
                                <i class="fas fa-gift me-2"></i>Rewards
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="pill" href="#character">
                                <i class="fas fa-user-ninja me-2"></i>Character
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Streaks Tab -->
                <div class="tab-pane fade show active" id="streaks">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="streak-card">
                                <i class="fas fa-dumbbell fa-2x streak-workout"></i>
                                <h5>Workout Streak</h5>
                                <p class="streak-number streak-workout" id="workoutStreak">0</p>
                                <small class="text-muted">Current streak</small>
                                <div class="mt-2">
                                    <small>Longest: <span id="workoutLongest">0</span> days</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="streak-card">
                                <i class="fas fa-apple-alt fa-2x streak-nutrition"></i>
                                <h5>Nutrition Streak</h5>
                                <p class="streak-number streak-nutrition" id="nutritionStreak">0</p>
                                <small class="text-muted">Current streak</small>
                                <div class="mt-2">
                                    <small>Longest: <span id="nutritionLongest">0</span> days</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="streak-card">
                                <i class="fas fa-calendar-check fa-2x streak-login"></i>
                                <h5>Login Streak</h5>
                                <p class="streak-number streak-login" id="loginStreak">0</p>
                                <small class="text-muted">Current streak</small>
                                <div class="mt-2">
                                    <small>Longest: <span id="loginLongest">0</span> days</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Milestones -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h4 class="text-white mb-3">
                                <i class="fas fa-target me-2"></i>Upcoming Milestones
                            </h4>
                            <div id="upcomingMilestones">
                                <!-- Milestones will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Tab -->
                <div class="tab-pane fade" id="achievements">
                    <div class="row">
                        <div class="col-12">
                            <h4 class="text-white mb-3">
                                <i class="fas fa-trophy me-2"></i>Your Achievements
                            </h4>
                            <div class="achievement-grid" id="achievementGrid">
                                <!-- Achievements will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rewards Tab -->
                <div class="tab-pane fade" id="rewards">
                    <div class="row">
                        <div class="col-md-6">
                            <h4 class="text-white mb-3">
                                <i class="fas fa-heart me-2"></i>Health Rewards
                            </h4>
                            <div id="healthRewards">
                                <!-- Health rewards will be loaded here -->
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h4 class="text-white mb-3">
                                <i class="fas fa-dumbbell me-2"></i>Fitness Rewards
                            </h4>
                            <div id="fitnessRewards">
                                <!-- Fitness rewards will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Character Tab -->
                <div class="tab-pane fade" id="character">
                    <div class="row">
                        <div class="col-md-8 mx-auto">
                            <div class="character-stats">
                                <h4 class="text-center mb-4">
                                    <i class="fas fa-user-ninja me-2"></i>Character Stats
                                </h4>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-fist-raised me-2"></i>Strength</span>
                                        <span id="strengthValue">10</span>
                                    </div>
                                    <div class="stat-bar">
                                        <div class="stat-fill stat-strength" id="strengthBar" style="width: 10%"></div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-running me-2"></i>Endurance</span>
                                        <span id="enduranceValue">10</span>
                                    </div>
                                    <div class="stat-bar">
                                        <div class="stat-fill stat-endurance" id="enduranceBar" style="width: 10%"></div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-leaf me-2"></i>Flexibility</span>
                                        <span id="flexibilityValue">10</span>
                                    </div>
                                    <div class="stat-bar">
                                        <div class="stat-fill stat-flexibility" id="flexibilityBar" style="width: 10%"></div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-apple-alt me-2"></i>Nutrition</span>
                                        <span id="nutritionValue">10</span>
                                    </div>
                                    <div class="stat-bar">
                                        <div class="stat-fill stat-nutrition" id="nutritionBar" style="width: 10%"></div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span><i class="fas fa-calendar-check me-2"></i>Consistency</span>
                                        <span id="consistencyValue">10</span>
                                    </div>
                                    <div class="stat-bar">
                                        <div class="stat-fill stat-consistency" id="consistencyBar" style="width: 10%"></div>
                                    </div>
                                </div>

                                <div class="text-center mt-4">
                                    <h5>Overall Power: <span id="overallPower">50</span></h5>
                                    <div class="stat-bar">
                                        <div class="stat-fill" id="overallBar" style="width: 50%; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-white mt-2">Loading your progress...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simple GSAP animations
        if (typeof gsap !== 'undefined') {
            gsap.from('.stats-card', {duration: 0.8, y: 50, opacity: 0, stagger: 0.2});
            gsap.from('.streak-card', {duration: 0.6, scale: 0.8, opacity: 0, stagger: 0.1, delay: 0.3});
            gsap.from('.level-display', {duration: 1, scale: 0.5, opacity: 0, ease: 'back.out(1.7)'});
        }
    </script>
    <script>
        class GamificationDashboard {
            constructor() {
                this.data = null;
                this.init();
            }

            async init() {
                await this.loadData();
                this.renderAll();
            }

            async loadData() {
                try {
                    document.getElementById('loadingSpinner').style.display = 'block';
                    
                    const [streakResponse, rewardsResponse] = await Promise.all([
                        fetch('/api/streaks/status'),
                        fetch('/api/streaks/rewards')
                    ]);

                    if (streakResponse.ok && rewardsResponse.ok) {
                        const streakData = await streakResponse.json();
                        const rewardsData = await rewardsResponse.json();
                        
                        this.data = {
                            streaks: streakData.streaks || {},
                            rewards: rewardsData.rewards || [],
                            level: this.calculateLevel(streakData.streaks),
                            totalXP: this.calculateTotalXP(streakData.streaks),
                            progressToNextLevel: this.calculateProgress(streakData.streaks),
                            xpToNextLevel: this.calculateXPToNext(streakData.streaks),
                            achievements: this.generateAchievements(streakData.streaks),
                            character: this.calculateCharacterStats(streakData.streaks)
                        };
                    } else {
                        throw new Error('Failed to load data');
                    }
                } catch (error) {
                    console.error('Error loading gamification data:', error);
                    this.showError('Failed to load gamification data');
                    // Provide fallback data
                    this.data = {
                        streaks: { workout: { current: 0, longest: 0 }, nutrition: { current: 0, longest: 0 }, login: { current: 0, longest: 0 } },
                        rewards: [],
                        level: 1,
                        totalXP: 0,
                        progressToNextLevel: 0,
                        xpToNextLevel: 100,
                        achievements: [],
                        character: { strength: 10, endurance: 10, flexibility: 10, nutrition: 10, consistency: 10, overall: 50 }
                    };
                } finally {
                    document.getElementById('loadingSpinner').style.display = 'none';
                }
            }

            calculateLevel(streaks) {
                const totalStreaks = (streaks.workout?.current || 0) + (streaks.nutrition?.current || 0) + (streaks.login?.current || 0);
                return Math.floor(totalStreaks / 10) + 1;
            }

            calculateTotalXP(streaks) {
                return ((streaks.workout?.current || 0) * 10) + ((streaks.nutrition?.current || 0) * 8) + ((streaks.login?.current || 0) * 5);
            }

            calculateProgress(streaks) {
                const level = this.calculateLevel(streaks);
                const xpForCurrentLevel = (level - 1) * 100;
                const totalXP = this.calculateTotalXP(streaks);
                const progressXP = totalXP - xpForCurrentLevel;
                return Math.min((progressXP / 100) * 100, 100);
            }

            calculateXPToNext(streaks) {
                const level = this.calculateLevel(streaks);
                const xpForNextLevel = level * 100;
                const totalXP = this.calculateTotalXP(streaks);
                return Math.max(xpForNextLevel - totalXP, 0);
            }

            generateAchievements(streaks) {
                const achievements = [];
                const workoutStreak = streaks.workout?.current || 0;
                const nutritionStreak = streaks.nutrition?.current || 0;
                const loginStreak = streaks.login?.current || 0;

                if (workoutStreak >= 3) achievements.push({ name: '3-Day Warrior', description: '3 consecutive workout days', icon: 'üèãÔ∏è', rarity: 'common', xpReward: 50, unlockedAt: new Date() });
                if (workoutStreak >= 7) achievements.push({ name: 'Week Champion', description: '7 consecutive workout days', icon: 'üèÜ', rarity: 'rare', xpReward: 100, unlockedAt: new Date() });
                if (nutritionStreak >= 3) achievements.push({ name: 'Nutrition Novice', description: '3 consecutive nutrition logs', icon: 'ü•ó', rarity: 'common', xpReward: 50, unlockedAt: new Date() });
                if (nutritionStreak >= 7) achievements.push({ name: 'Macro Master', description: '7 consecutive nutrition logs', icon: 'üìä', rarity: 'rare', xpReward: 100, unlockedAt: new Date() });
                if (loginStreak >= 7) achievements.push({ name: 'Consistency King', description: '7 consecutive login days', icon: 'üëë', rarity: 'rare', xpReward: 75, unlockedAt: new Date() });

                return achievements;
            }

            calculateCharacterStats(streaks) {
                const workoutStreak = streaks.workout?.current || 0;
                const nutritionStreak = streaks.nutrition?.current || 0;
                const loginStreak = streaks.login?.current || 0;

                return {
                    strength: Math.min(10 + (workoutStreak * 2), 100),
                    endurance: Math.min(10 + (workoutStreak * 1.5), 100),
                    flexibility: Math.min(10 + (workoutStreak * 1), 100),
                    nutrition: Math.min(10 + (nutritionStreak * 2), 100),
                    consistency: Math.min(10 + (loginStreak * 1.5), 100),
                    overall: Math.min(50 + ((workoutStreak + nutritionStreak + loginStreak) * 2), 500)
                };
            }

            renderAll() {
                if (!this.data) return;
                
                this.renderLevel();
                this.renderStreaks();
                this.renderAchievements();
                this.renderRewards();
                this.renderCharacterStats();
                this.renderUpcomingMilestones();
            }

            renderLevel() {
                const { level, totalXP, progressToNextLevel } = this.data;
                
                document.getElementById('userLevel').textContent = level || 1;
                document.getElementById('xpProgressBar').style.width = `${progressToNextLevel || 0}%`;
                document.getElementById('xpText').textContent = `${totalXP || 0} XP`;
                document.getElementById('xpToNext').textContent = `${this.data.xpToNextLevel || 100} XP to next level`;
            }

            renderStreaks() {
                const streaks = this.data.streaks || {};
                
                // Workout streak
                document.getElementById('workoutStreak').textContent = streaks.workout?.current || 0;
                document.getElementById('workoutLongest').textContent = streaks.workout?.longest || 0;
                
                // Nutrition streak
                document.getElementById('nutritionStreak').textContent = streaks.nutrition?.current || 0;
                document.getElementById('nutritionLongest').textContent = streaks.nutrition?.longest || 0;
                
                // Login streak
                document.getElementById('loginStreak').textContent = streaks.login?.current || 0;
                document.getElementById('loginLongest').textContent = streaks.login?.longest || 0;
            }

            renderAchievements() {
                const achievements = this.data.achievements || [];
                const achievementGrid = document.getElementById('achievementGrid');
                
                if (achievements.length === 0) {
                    achievementGrid.innerHTML = `
                        <div class="col-12 text-center">
                            <div class="achievement-card">
                                <i class="fas fa-star achievement-icon text-muted"></i>
                                <h5>No Achievements Yet</h5>
                                <p class="text-muted">Start working out and logging nutrition to earn your first achievement!</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                achievementGrid.innerHTML = achievements.map(achievement => `
                    <div class="achievement-card">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <h5>${achievement.name}</h5>
                        <p class="text-muted">${achievement.description}</p>
                        <small class="text-success">+${achievement.xpReward} XP</small>
                        <div class="mt-2">
                            <span class="badge bg-${this.getRarityColor(achievement.rarity)}">${achievement.rarity}</span>
                        </div>
                        <small class="text-muted d-block mt-1">
                            Unlocked: ${new Date(achievement.unlockedAt).toLocaleDateString()}
                        </small>
                    </div>
                `).join('');
            }

            renderRewards() {
                const rewards = this.data.rewards || [];
                const healthRewards = rewards.filter(r => r.subType === 'nutrition' || r.type === 'health');
                const fitnessRewards = rewards.filter(r => r.subType === 'workout' || r.type === 'fitness');

                this.renderRewardSection('healthRewards', healthRewards, 'health');
                this.renderRewardSection('fitnessRewards', fitnessRewards, 'fitness');
            }

            renderRewardSection(containerId, rewards, type) {
                const container = document.getElementById(containerId);
                
                if (rewards.length === 0) {
                    container.innerHTML = `
                        <div class="reward-card">
                            <h6><i class="fas fa-info-circle me-2"></i>No ${type} rewards yet</h6>
                            <p class="text-muted mb-0">Keep up your streaks to earn ${type} rewards!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = rewards.map(reward => {
                    const cardClass = `reward-${type}`;
                    
                    return `
                        <div class="reward-card ${cardClass}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6>
                                        ${this.getRewardIcon(reward.subType || type)} ${reward.name}
                                    </h6>
                                    <p class="mb-2">${reward.description}</p>
                                    <small class="text-muted">
                                        <strong>Value:</strong> ${reward.value}
                                    </small>
                                    <br>
                                    <small class="text-muted">
                                        <strong>Streak:</strong> ${reward.streakCount || 0} days
                                    </small>
                                </div>
                                <div>
                                    <span class="badge bg-${this.getRarityColor(reward.rarity)}">${reward.rarity}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            getRewardIcon(type) {
                const icons = {
                    workout: 'üèãÔ∏è',
                    nutrition: 'ü•ó',
                    health: '‚ù§Ô∏è',
                    fitness: 'üí™'
                };
                return icons[type] || 'üéÅ';
            }

            renderCharacterStats() {
                const character = this.data.character || {};
                const stats = ['strength', 'endurance', 'flexibility', 'nutrition', 'consistency'];
                
                stats.forEach(stat => {
                    const value = character[stat] || 10;
                    const percentage = Math.min((value / 100) * 100, 100);
                    
                    document.getElementById(`${stat}Value`).textContent = value;
                    document.getElementById(`${stat}Bar`).style.width = `${percentage}%`;
                });

                const overall = character.overall || 50;
                document.getElementById('overallPower').textContent = overall;
                document.getElementById('overallBar').style.width = `${Math.min((overall / 500) * 100, 100)}%`;
            }

            renderUpcomingMilestones() {
                const streaks = this.data.streaks || {};
                const milestones = [3, 7, 14, 30, 50, 100];
                const upcomingMilestones = [];

                // Generate upcoming milestones for workout streak
                const workoutCurrent = streaks.workout?.current || 0;
                const nextWorkoutMilestone = milestones.find(m => m > workoutCurrent);
                if (nextWorkoutMilestone) {
                    upcomingMilestones.push({
                        type: 'workout',
                        milestone: nextWorkoutMilestone,
                        daysToGo: nextWorkoutMilestone - workoutCurrent,
                        isNext: true,
                        reward: this.getMilestoneReward('workout', nextWorkoutMilestone)
                    });
                }

                // Generate upcoming milestones for nutrition streak
                const nutritionCurrent = streaks.nutrition?.current || 0;
                const nextNutritionMilestone = milestones.find(m => m > nutritionCurrent);
                if (nextNutritionMilestone) {
                    upcomingMilestones.push({
                        type: 'nutrition',
                        milestone: nextNutritionMilestone,
                        daysToGo: nextNutritionMilestone - nutritionCurrent,
                        isNext: upcomingMilestones.length === 0,
                        reward: this.getMilestoneReward('nutrition', nextNutritionMilestone)
                    });
                }
                
                const container = document.getElementById('upcomingMilestones');

                if (upcomingMilestones.length === 0) {
                    container.innerHTML = `
                        <div class="milestone-card">
                            <h6><i class="fas fa-info-circle me-2"></i>No upcoming milestones</h6>
                            <p class="mb-0">Keep working out and logging nutrition to see your next rewards!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = upcomingMilestones.slice(0, 3).map(milestone => `
                    <div class="milestone-card ${milestone.isNext ? 'milestone-next' : ''}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6>
                                    ${milestone.isNext ? 'üéØ' : '‚≠ê'} ${milestone.milestone} Day ${milestone.type} Milestone
                                    ${milestone.isNext ? ' (Next!)' : ''}
                                </h6>
                                <p class="mb-0">
                                    <strong>Reward:</strong> ${milestone.reward}
                                </p>
                            </div>
                            <div class="text-end">
                                <h5 class="mb-0">${milestone.daysToGo}</h5>
                                <small>days to go</small>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getMilestoneReward(type, milestone) {
                const rewards = {
                    workout: {
                        3: 'Unlock new workout routines',
                        7: 'Premium workout plans access',
                        14: 'Personal trainer tips',
                        30: 'Custom workout generator',
                        50: 'Advanced analytics',
                        100: 'Lifetime premium features'
                    },
                    nutrition: {
                        3: 'Meal planning tips',
                        7: 'Premium recipes access',
                        14: 'Nutritionist consultation',
                        30: 'Custom meal plans',
                        50: 'Advanced nutrition analytics',
                        100: 'Personal nutritionist access'
                    }
                };
                return rewards[type]?.[milestone] || 'Special reward';
            }

            async useReward(rewardId) {
                this.showSuccess('Reward feature coming soon!');
            }

            getRarityColor(rarity) {
                const colors = {
                    'common': 'secondary',
                    'rare': 'primary',
                    'epic': 'warning',
                    'legendary': 'danger'
                };
                return colors[rarity] || 'secondary';
            }

            showSuccess(message) {
                alert(message);
            }

            showError(message) {
                alert(message);
            }
        }

        // Initialize dashboard when page loads
        let dashboard;
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new GamificationDashboard();
        });
    </script>
</body>
</html>